
## BEGIN EXPIRES CACHING - JCH OPTIMIZE ##
<IfModule mod_expires.c>
	ExpiresActive on

	# Your document html
	ExpiresByType text/html "access plus 0 seconds"

	# Data
	ExpiresByType text/xml "access plus 0 seconds"
	ExpiresByType application/xml "access plus 0 seconds"
	ExpiresByType application/json "access plus 0 seconds"

	# Feed
	ExpiresByType application/rss+xml "access plus 1 hour"
	ExpiresByType application/atom+xml "access plus 1 hour"

	# Favicon (cannot be renamed)
	ExpiresByType image/x-icon "access plus 1 week"

	# Media: images, video, audio
	ExpiresByType image/gif "access plus 1 year"
	ExpiresByType image/png "access plus 1 year"
	ExpiresByType image/jpg "access plus 1 year"
	ExpiresByType image/jpeg "access plus 1 year"
	ExpiresByType image/webp "access plus 1 year"
	ExpiresByType audio/ogg "access plus 1 year"
	ExpiresByType video/ogg "access plus 1 year"
	ExpiresByType video/mp4 "access plus 1 year"
	ExpiresByType video/webm "access plus 1 year"

	# HTC files (css3pie)
	ExpiresByType text/x-component "access plus 1 year"

	# Webfonts
	ExpiresByType image/svg+xml "access plus 1 year"
	ExpiresByType font/* "access plus 1 year"
	ExpiresByType application/x-font-ttf "access plus 1 year"
	ExpiresByType application/x-font-truetype "access plus 1 year"
	ExpiresByType application/x-font-opentype "access plus 1 year"
	ExpiresByType application/font-ttf "access plus 1 year"
	ExpiresByType application/font-woff "access plus 1 year"
	ExpiresByType application/font-woff2 "access plus 1 year"
	ExpiresByType application/vnd.ms-fontobject "access plus 1 year"
	ExpiresByType application/font-sfnt "access plus 1 year"

	# CSS and JavaScript
	ExpiresByType text/css "access plus 1 year"
	ExpiresByType text/javascript "access plus 1 year"
	ExpiresByType application/javascript "access plus 1 year"

	<IfModule mod_headers.c>
		Header set Cache-Control "no-cache, no-store, must-revalidate"
		
		<FilesMatch "\.(js|css|ttf|woff2?|svg|png|jpe?g|webp|webm|mp4|ogg)(\.gz)?$">
			Header set Cache-Control "public"	
			Header set Vary: Accept-Encoding
		</FilesMatch>
		#Some server not properly recognizing WEBPs
		<FilesMatch "\.webp$">
			Header set Content-Type "image/webp"
			ExpiresDefault "access plus 1 year"
		</FilesMatch>	
	</IfModule>

</IfModule>

<IfModule mod_brotli.c>
	<IfModule mod_filter.c>
		AddOutputFilterByType BROTLI_COMPRESS text/html text/xml text/plain 
		AddOutputFilterByType BROTLI_COMPRESS application/rss+xml application/xml application/xhtml+xml 
		AddOutputFilterByType BROTLI_COMPRESS text/css 
		AddOutputFilterByType BROTLI_COMPRESS text/javascript application/javascript application/x-javascript 
		AddOutputFilterByType BROTLI_COMPRESS image/x-icon image/svg+xml
		AddOutputFilterByType BROTLI_COMPRESS application/rss+xml
		AddOutputFilterByType BROTLI_COMPRESS application/font application/font-truetype application/font-ttf
		AddOutputFilterByType BROTLI_COMPRESS application/font-otf application/font-opentype
		AddOutputFilterByType BROTLI_COMPRESS application/font-woff application/font-woff2
		AddOutputFilterByType BROTLI_COMPRESS application/vnd.ms-fontobject
		AddOutputFilterByType BROTLI_COMPRESS font/ttf font/otf font/opentype font/woff font/woff2
	</IfModule>
</IfModule>

<IfModule mod_deflate.c>
	<IfModule mod_filter.c>
		AddOutputFilterByType DEFLATE text/html text/xml text/plain 
		AddOutputFilterByType DEFLATE application/rss+xml application/xml application/xhtml+xml 
		AddOutputFilterByType DEFLATE text/css 
		AddOutputFilterByType DEFLATE text/javascript application/javascript application/x-javascript 
		AddOutputFilterByType DEFLATE image/x-icon image/svg+xml
		AddOutputFilterByType DEFLATE application/rss+xml
		AddOutputFilterByType DEFLATE application/font application/font-truetype application/font-ttf
		AddOutputFilterByType DEFLATE application/font-otf application/font-opentype
		AddOutputFilterByType DEFLATE application/font-woff application/font-woff2
		AddOutputFilterByType DEFLATE application/vnd.ms-fontobject
		AddOutputFilterByType DEFLATE font/ttf font/otf font/opentype font/woff font/woff2
	</IfModule>
</IfModule>

# Don't compress files with extension .gz or .br
<IfModule mod_rewrite.c>
	RewriteRule "\.(gz|br)$" "-" [E=no-gzip:1,E=no-brotli:1]
</IfModule>

<IfModule !mod_rewrite.c>
	<IfModule mod_setenvif.c>
		SetEnvIfNoCase Request_URI \.(gz|br)$ no-gzip no-brotli
	</IfModule>
</IfModule>
## END EXPIRES CACHING - JCH OPTIMIZE ##

##
# @package    Joomla
# @copyright  Copyright (C) 2005 - 2019 Open Source Matters. All rights reserved.
# @license    GNU General Public License version 2 or later; see LICENSE.txt
##

##
# READ THIS COMPLETELY IF YOU CHOOSE TO USE THIS FILE!
#
# The line 'Options +FollowSymLinks' may cause problems with some server configurations.
# It is required for the use of mod_rewrite, but it may have already been set by your
# server administrator in a way that disallows changing it in this .htaccess file.
# If using it causes your site to produce an error, comment it out (add # to the
# beginning of the line), reload your site in your browser and test your sef urls. If
# they work, then it has been set by your server administrator and you do not need to
# set it here.
##

## No directory listings
#<IfModule autoindex>
#  IndexIgnore *
#</IfModule>

## Suppress mime type detection in browsers for unknown types
<IfModule mod_headers.c>
Header always set X-Content-Type-Options "nosniff"
</IfModule>

## Can be commented out if causes errors, see notes above.
#Options +FollowSymlinks
#Options -Indexes

## Mod_rewrite in use.

RewriteEngine On

## Begin - Rewrite rules to block out some common exploits.
# If you experience problems on your site then comment out the operations listed
# below by adding a # to the beginning of the line.
# This attempts to block the most common type of exploit `attempts` on Joomla!
#
# Block any script trying to base64_encode data within the URL.
RewriteCond %{QUERY_STRING} base64_encode[^(]*\([^)]*\) [OR]
# Block any script that includes a <script> tag in URL.
RewriteCond %{QUERY_STRING} (<|%3C)([^s]*s)+cript.*(>|%3E) [NC,OR]
# Block any script trying to set a PHP GLOBALS variable via URL.
RewriteCond %{QUERY_STRING} GLOBALS(=|\[|\%[0-9A-Z]{0,2}) [OR]
# Block any script trying to modify a _REQUEST variable via URL.
RewriteCond %{QUERY_STRING} _REQUEST(=|\[|\%[0-9A-Z]{0,2})
# Return 403 Forbidden header and show the content of the root home page
RewriteRule .* index.php [F]
#
## End - Rewrite rules to block out some common exploits.

## Begin - Custom redirects
RewriteCond %{HTTP_HOST} ^www\.(.*) [NC]
RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

#Redirect 301 /catalog https://stovesta.ru/spareparts
#Redirect 301 /about-us/express https://stovesta.ru/express
#Redirect 301 /about-us/express https://stovesta.ru/express
# Редирект старых категорий Аксессуары
Redirect 301 /accessories/categories/6-accessories/144-vesta-sedan https://stovesta.ru/accessories/categories/6-accessories/144-vesta
Redirect 301 /accessories/categories/6-accessories/145-vesta-sw https://stovesta.ru/accessories/categories/6-accessories/144-vesta
Redirect 301 /accessories/categories/6-accessories/146-vesta-sw-cross https://stovesta.ru/accessories/categories/6-accessories/144-vesta
# Редирект старых категорий Запчасти
RewriteRule ^spareparts/categories/1-spareparts/([0-9]+)-vesta-(.*)$ https://stovesta.ru/spareparts/categories/1-spareparts/2-vesta [R=301,L]
RewriteRule ^spareparts/categories/1-spareparts/([0-9]+)-xray-(.*)$ https://stovesta.ru/spareparts/categories/1-spareparts/3-xray [R=301,L]
# Редирект старых категорий Ремонт
RewriteRule ^repair/categories/4-repair/([0-9]+)-vesta-(.*)$ https://stovesta.ru/repair/categories/4-repair/74-vesta [R=301,L]
RewriteRule ^repair/categories/4-repair/([0-9]+)-xray-(.*)$ https://stovesta.ru/repair/categories/4-repair/75-xray [R=301,L]
Redirect 301 /repair/categories/4-repair/75-repair-xray https://stovesta.ru/repair/categories/4-repair/75-xray
# Редирект старых категорий Техобслуживание
Redirect 301 /maintenance/categories/5-maintenance/109-maintenance-vesta-sedan https://stovesta.ru/maintenance/categories/5-maintenance/109-maintenance-vesta
# Редирект для удаления категории из url
# Запчасти - https://stovesta.ru/spareparts/item/2-vesta/1967-adsorber-toplivnykh-parov-vesta-sw-cross-1-6-i-1-8-2015-lada
RewriteRule ^spareparts/item/(.+)/(.+)$ https://stovesta.ru/spareparts/item/$2 [R=301,L]
# Аксессуары - https://stovesta.ru/accessories/item/144-vesta/1884-avtoodeyalo-avtoteplo-vesta-1-6-i-1-8-c-2015
RewriteRule ^accessories/item/(.+)/(.+)$ https://stovesta.ru/accessories/item/$2 [R=301,L]
# Ремонт - https://stovesta.ru/repair/item/78-vesta-sedan-engine/1442-absorber-toplivnykh-parov-lada-vesta-xray-1-6-i-1-8-s-2015-zamena
RewriteRule ^repair/item/(.+)/(.+)$ https://stovesta.ru/repair/item/$2 [R=301,L]
# Техобслуживание - https://stovesta.ru/maintenance/item/109-maintenance-vesta-sedan/1312-tekhnicheskoe-obsluzhivanie-lada-vesta-30000-km-to-2-1-6-i-1-8-s-2015
RewriteRule ^maintenance/item/(.+)/(.+)$ https://stovesta.ru/maintenance/item/$2 [R=301,L]
# Доп. оборудование - https://stovesta.ru/add-equipment/item/148-add-equipment-vesta-sedan/1879-kryuk-veshchevoj-v-bagazhnik-lada-vesta
RewriteRule ^add-equipment/item/(.+)/(.+)$ https://stovesta.ru/add-equipment/item/$2 [R=301,L]
# Исправляем ошибку в URL картинки в галерее - https://stovesta.ru/images/gallery2017-11/1510466400_f18c93b9eb7014dd63e86154dc2bd4bb.jpg
#RewriteRule ^images/gallery(.+)/(.+)$ https://stovesta.ru/images/gallery/$1/$2 [R=301,L]
# Редирект раздела Партнеры
Redirect 301 /partners/our-partners https://stovesta.ru/partners
Redirect 301 /partners/partners-programm https://stovesta.ru/partners
# Редирект раздела О нас
Redirect 301 /about-us/vacancies https://stovesta.ru/about-us
Redirect 301 /about-us/terms-of-use https://stovesta.ru/about-us
Redirect 301 /about-us/guarantee https://stovesta.ru/about-us
# Редирект раздела Скидки и Акции
Redirect 301 /discounts/tekushchie-aktsii https://stovesta.ru/discounts
Redirect 301 /discounts/discount-cards https://stovesta.ru/discounts
Redirect 301 /discounts/grafik-raboty https://stovesta.ru/discounts
# Редирект раздела Доп. оборудование
Redirect 301 /add-equipment https://stovesta.ru/accessories
# Редирект раздела Чип-тюнинг
Redirect 301 /chip-tyuning https://stovesta.ru
# Редирект раздела Организациям
Redirect 301 /companies https://stovesta.ru
# Редирект раздела Доставка
Redirect 301 /delivery https://stovesta.ru
# Редирект для коротких ссылок
Redirect 301 /maslo https://stovesta.ru/discounts#aktsiya-besplatnaya-zamena-masla
Redirect 301 /oil https://stovesta.ru/discounts#aktsiya-besplatnaya-zamena-masla
Redirect 301 /largus https://stovesta.ru/news/item/6862-largus-shopa-bolshe-net
Redirect 301 /fake-products https://stovesta.ru/counterfeit
Redirect 301 /grm https://stovesta.ru/discounts#aktsiya-skidka-na-zamenu-grm-50
Redirect 301 /time https://stovesta.ru/discounts#aktsiya-slozhnye-vremena
Redirect 301 /new https://stovesta.ru/discounts#aktsiya-skidka-v-chest-otkrytiya
Redirect 301 /shin https://stovesta.ru/catalog/item/8312-sezonnyj-shinomontazh

# Временно скрываем раздел Чип-тюнинг
#Redirect 301 /chip-tyuning https://stovesta.ru/index.php?option=com_cobalt&view=record&id=2306
## End - Custom redirects

##
# Uncomment the following line if your webserver's URL
# is not directly related to physical file paths.
# Update Your Joomla! Directory (just / for root).
##

# RewriteBase /

## Begin - Joomla! core SEF Section.
#
RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
#
# If the requested path and file is not /index.php and the request
# has not already been internally rewritten to the index.php script
RewriteCond %{REQUEST_URI} !^/index\.php
# and the requested path and file doesn't directly match a physical file
RewriteCond %{REQUEST_FILENAME} !-f
# and the requested path and file doesn't directly match a physical folder
RewriteCond %{REQUEST_FILENAME} !-d
# internally rewrite the request to the index.php script
RewriteRule .* index.php [L]
#
## End - Joomla! core SEF Section.

